// Generated by CoffeeScript 1.3.3
(function() {

  $(function() {
    var check,
      _this = this;
    $('button#submit').click(function() {
      var data, val1, val2;
      val1 = $('input#val1').val();
      val2 = $('input#val2').val();
      console.log("send task");
      data = [val1, val2];
      console.log(data);
      return $.ajax({
        url: "/celerydemo/start/celerydemo.tasks.add/",
        data: {
          val1: val1,
          val2: val2
        },
        type: "POST",
        success: function(data, textStatus, jqXHR) {
          var responseDate;
          responseDate = jqXHR.getResponseHeader('Date');
          if (data.error) {
            return $('#output').append("<div style='margin-bottom: 20px'><p style='color: red'><small>" + responseDate + " ERROR " + data.error + "</small></p></div>");
          } else {
            $('#output').append("<div style='margin-bottom: 20px'><p style='color: green'><small>" + responseDate + " INFO Task started (" + data.id + ")</small></p></div>");
            return check(data.id);
          }
        }
      });
    });
    return check = function(id) {
      var check_state, state,
        _this = this;
      state = false;
      return (check_state = function() {
        if (state === false) {
          $.ajax({
            url: "/celerydemo/status/" + id + "/",
            type: "GET",
            success: function(data, textStatus, jqXHR) {
              var responseDate;
              responseDate = jqXHR.getResponseHeader('Date');
              console.log(id);
              console.log(data);
              $('#output').append("<div style='margin-bottom: 20px'><p style='color: green'><small>" + responseDate + " INFO Task done(" + data.state + ")</small></p></div>");
              if (data.state === "SUCCESS") {
                return state = true;
              }
            }
          });
        }
        if (state !== true) {
          return setTimeout(check_state, 4000);
        }
      })();
    };
  });

}).call(this);
